#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å –ø–æ–º–æ—â—å—é git diff
STAGED_TS_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep "\.tsx\?$" || true)
STAGED_SCSS_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep "\.scss$" || true)

# 2. –ó–∞–ø—É—Å–∫–∞–µ–º –ª–∏–Ω—Ç–µ—Ä—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
if [ -n "$STAGED_TS_FILES" ]; then
  echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ TS —Ñ–∞–π–ª–æ–≤..."
  pnpm eslint $STAGED_TS_FILES --cache --fix || exit 1
else
  echo "‚úÖ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö TS —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏"
fi

if [ -n "$STAGED_SCSS_FILES" ]; then
  echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ SCSS —Ñ–∞–π–ª–æ–≤..."
  pnpm stylelint $STAGED_SCSS_FILES --cache --fix || exit 1
else
  echo "‚úÖ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö SCSS —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏"
fi


echo "‚ú® Pre-commit –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã!"
